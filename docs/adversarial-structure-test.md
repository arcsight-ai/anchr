# Adversarial structure test (Day 3)

**Freeze commit:** 6597d00c1cf47a86fa6c1e8a0db5d987e9c3232f  
**Repo:** sindresorhus/ky (medium-sized, Phase 1)

## A) Dependency injection test

**Structural change:** Added two files in `source/` that form a circular import:
- `source/adversarial-cycle-a.ts` imports `./adversarial-cycle-b.js`
- `source/adversarial-cycle-b.ts` imports `./adversarial-cycle-a.js`

No functional logic change. Compiles (synthetic edge only).

| Metric | Before (base) | After (injection) |
|--------|----------------|-------------------|
| minimalCut | [] | `["root:source/adversarial-cycle-a.ts:circular_import"]` |
| violation_count | 0 | 1 |
| decision | allow | block |

**Explanation excerpt:** root:source/adversarial-cycle-a.ts:circular_import

**Result:** PASS — structural risk signal increased

---

## B) Dependency removal test

**Structural change:** Removed the circular edge (checkout back to base). Diff = injection_sha → base_sha.

| Metric | Before (injection) | After (removal) |
|--------|---------------------|-----------------|
| minimalCut | 1 items | 0 items |
| violation_count | 1 | 0 |
| decision | block | allow |

**Result:** PASS — structural risk signal decreased

---

## Summary

| Test | Result |
|------|--------|
| Injection (add edge → risk up) | PASS |
| Removal (remove edge → risk down) | PASS |
| **Day 3 overall** | **PASS** |

**Wiring fixes made:** One. Side-effect-only imports (e.g. `import "./x.js"` with no clause) were not creating graph edges; `isTypeOnlyImportClause(undefined)` returned `true` and those imports were skipped. Changed to return `false` for no clause so side-effect imports are included in valueImports and the cycle was detected. File: `src/parse/parseImportsAndReexports.ts`. No scoring or feature change.

---
*Generated by scripts/hardening/day3-adversarial-structure.ts*
